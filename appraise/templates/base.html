
{% with bootstrap_url="http://getbootstrap.com/2.3.2" %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="robots" content="NONE,NOARCHIVE">
    <meta charset="utf-8">
    <title>{{title}}{% block title %}{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Appraise">
    <meta name="author" content="Christian Federmann">

    <!-- Le styles -->
    <link href="{{bootstrap_url}}/assets/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      small{display:block;line-height:18px;color:#999999;}small:before{content:'\2014 \00A0';}
    </style>


    <!-- -->
    <link href="{{bootstrap_url}}/assets/css/bootstrap-responsive.css" rel="stylesheet">
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="http://192.168.0.107:8080/socket.io/socket.io.js"></script>
    <script>
        var activeRegion = 0;
        var timeRegion = 0;
        var eyeTribeData = [];

        $(function(){
            var iosocket = io.connect('http://192.168.0.107:8080');
            var c = document.getElementById("myCanvas");
            var ctx = c.getContext('2d');

            var myCanvasDraw = function( col ){
                    ctx.fillStyle= col ;
                    ctx.beginPath();
                    ctx.arc(50,50,50,0,2*Math.PI);
                    ctx.fillStyle= col ; 
                    ctx.fill(); 
            };


            iosocket.on('connect', function () {
                $('#incomingChatMessages').append($('<li>Connected</li>'));
 
                iosocket.on('message', function(message) {
                    //$('#incomingChatMessages').append($('<li></li>').text(message));
                    var curRegion  = "Out";
                    var curRegionColor = "#ffe629";

                    var obj = jQuery.parseJSON( message );
                    var curTime = new Date().getTime();
                    if( obj != null) {
                        var d = document.getElementById("canvasWrapper");
                        d.style.left = (obj.x-50-50)+ 'px';
                        d.style.top = (obj.y-50-50 -1)+ 'px';
                        //ctx.canvas.left = obj.x+ 'px';
                        //ctx.canvas.top = obj.y+ 'px';
                        
                        possrc0 = $("#divsrc0").position();
                        possrc1 = $("#divsrc1").position();
                        possrc2 = $("#divsrc2").position();                        
                        posref0 = $("#divref0").position();
                        posref1 = $("#divref1").position();
                        posref2 = $("#divref2").position();
                        postrn = $("#divtrn").position();

                        if(typeof(possrc0) !== "undefined") 
                          if(possrc0.top<(obj.y) && (possrc0.top+$("#divsrc0").height())>(obj.y) && possrc0.left<(obj.x) && (possrc0.left+$("#divsrc0").width())>(obj.x)) {
                            //console.log("src,"+obj.x+","+obj.y+","+curTime);
                            curRegion = "Src0";
                            curRegionColor = "#ff5b4c";
                          }

                        if(typeof(possrc1) !== "undefined") 
                          if(possrc1.top<(obj.y) && (possrc1.top+$("#divsrc1").height())>(obj.y) && possrc1.left<(obj.x) && (possrc1.left+$("#divsrc1").width())>(obj.x)) {
                            //console.log("src,"+obj.x+","+obj.y+","+curTime);
                            curRegion = "Src1";
                            curRegionColor = "#ff5b4c";
                          }

                        if(typeof(possrc2) !== "undefined") 
                          if(possrc2.top<(obj.y) && (possrc2.top+$("#divsrc2").height())>(obj.y) && possrc2.left<(obj.x) && (possrc2.left+$("#divsrc2").width())>(obj.x)) {
                            //console.log("src,"+obj.x+","+obj.y+","+curTime);
                            curRegion = "Src2";
                            curRegionColor = "#ff5b4c";
                          }

                        if(typeof(posref0) !== "undefined") 
                          if(posref0.top<(obj.y) && (posref0.top+$("#divref0").height())>(obj.y) && posref0.left<(obj.x) && (posref0.left+$("#divref0").width())>(obj.x)) {
                            //console.log("ref,"+obj.x+","+obj.y+","+curTime);
                            curRegion = "Ref0";
                            curRegionColor = "#67ff3d";
                          }

                        if(typeof(posref1) !== "undefined") 
                          if(posref1.top<(obj.y) && (posref1.top+$("#divref1").height())>(obj.y) && posref1.left<(obj.x) && (posref1.left+$("#divref1").width())>(obj.x)) {
                            //console.log("ref,"+obj.x+","+obj.y+","+curTime);
                            curRegion = "Ref1";
                            curRegionColor = "#67ff3d";
                          }

                        if(typeof(posref2) !== "undefined") 
                          if(posref2.top<(obj.y) && (posref2.top+$("#divref2").height())>(obj.y) && posref2.left<(obj.x) && (posref2.left+$("#divref2").width())>(obj.x)) {
                            //console.log("ref,"+obj.x+","+obj.y+","+curTime);
                            curRegion = "Ref2";
                            curRegionColor = "#67ff3d";
                          }

                        if(typeof(postrn) !== "undefined") 
                          if(postrn.top<(obj.y) && (postrn.top+$("#divtrn").height())>(obj.y) && postrn.left<(obj.x) && (postrn.left+$("#divtrn").width())>(obj.x)) {
                            //console.log("trn,"+obj.x+","+obj.y+","+curTime);
                            curRegion = "Trn"
                            curRegionColor = "#735dff";
                          }
                        
                        if(curRegion === "Out"){
                          //console.log("out,"+obj.x+","+obj.y+","+curTime);
                          curRegion = "Out";
                          timeRegion = curTime;
                          curRegionColor = "#ffe629";
                        }
                        
                        if(curRegion != activeRegion) {
                          
                          eyeTribeData.push("{'task':'"+$("#task_progress").text()+"','Region':'"+activeRegion+"','time':'"+(curTime-timeRegion)+"'}");
                          console.log($("#task_progress").text()+", Region:"+activeRegion+" time:"+curTime+", "+timeRegion+", "+(curTime-timeRegion));
                          timeRegion = curTime;
                          activeRegion = curRegion;
                        }

                        myCanvasDraw(curRegionColor);
                        
                  }
                   
                });

                iosocket.on('disconnect', function() {
                    //$('#incomingChatMessages').append('<li>Disconnected</li>');
                });
            });
 
            $('#outgoingChatMessage').keypress(function(event) {
                if(event.which == 13) {
                    event.preventDefault();
                    iosocket.send($('#outgoingChatMessage').val());
                    //$('#incomingChatMessages').append($('<li></li>').text($('#outgoingChatMessage').val()));
                    $('#outgoingChatMessage').val('');
                }
            });
        });

    </script>

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="{{bootstrap_url}}/assets/js/html5shiv.js"></script>
    <![endif]-->

  <!-- slider css/js -->
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
  <link rel="stylesheet" href="/appraise/files/css/style.css"> <!-- Resource style -->
  <script src="/appraise/files/js/main.js"></script> <!-- Resource jQuery -->

  <script language="javascript">
    // define the function within the global scope
    var submitForm = function() {

        //eyeTribeData.push('{"task":"val"}');
        //eyeTribeData.push('{"task":"car"}');
        if($('button.btn').text()==' Submit') {

        $("#eyedata").val(eyeTribeData);
        $("#sscore").val($("#output").text());
        var eval = Math.round(Math.abs($("#sscore").val() - $("#oscore").val())/10);

        switch (eval) {
        case 0: $("#feedback").text("** Your Score is great! The actual score is "+Math.round($("#oscore").val()));
          break;
        case 1: $("#feedback").text("** Your Score is good. The actual score is "+Math.round($("#oscore").val()));
          break;
        case 2: $("#feedback").text("** Your Score is Okay. The actual score is "+Math.round($("#oscore").val()));
          break;
        case 3: $("#feedback").text("** Are you allright!. The actual score is "+Math.round($("#oscore").val()));
          break;
        case 4: $("#feedback").text("** Did you have your breakfast today!!. The actual score is "+Math.round($("#oscore").val()));
          break;
        case 5: $("#feedback").text("** Are you insane, you are missing it!!!. The actual score is "+Math.round($("#oscore").val()));
          break;
        default: $("#feedback").text("** Your are loosing it!!! The actual score is "+Math.round($("#oscore").val()));
        }
        //$('.cd-popup').addClass('is-visible');
         $('button.btn').html('<i class="icon-ok"></i> Next');
      }
      else {
        $("#myform").submit();
        $('button.btn').html('<i class="icon-ok"></i> Submit');
      };
    }

  </script>
  <script src="{{ STATIC_URL }}js/simple-slider.js"></script>

  <link href="{{ STATIC_URL }}css/simple-slider.css" rel="stylesheet" type="text/css" />
  <link href="{{ STATIC_URL }}css/simple-slider-volume.css" rel="stylesheet" type="text/css" />  
  
  <style>
   [class^=slider] { display: inline-block; margin-top: 3px; margin-bottom: 20px; }
  .output { color: #888; font-size: 16px; padding-top: 1px; margin-left: 5px; vertical-align: top;}
  </style>


    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="{{bootstrap_url}}/assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="{{bootstrap_url}}/assets/ico/apple-touch-icon-114-precomposed.png">
      <link rel="apple-touch-icon-precomposed" sizes="72x72" href="{{bootstrap_url}}/assets/ico/apple-touch-icon-72-precomposed.png">
                    <link rel="apple-touch-icon-precomposed" href="{{bootstrap_url}}/assets/ico/apple-touch-icon-57-precomposed.png">
                                   <link rel="shortcut icon" href="{{bootstrap_url}}/assets/ico/favicon.png">

{% block head %}{% endblock %}
  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="{% url appraise.views.frontpage %}">Appraise</a>
          <div class="nav-collapse">
            <ul class="nav">
{% if "evaluation" in installed_apps %}
              <li {% if active_page == "OVERVIEW" %}class="active"{% endif %}><a href="{% url appraise.evaluation.views.overview %}">Overview</a></li>

              {% if user.is_staff %}<li {% if active_page == "STATUS" %}class="active"{% endif %}><a href="{% url appraise.evaluation.views.status_view %}">Status</a></li>{% endif %}

{% endif %}

            </ul>

            <ul class="nav pull-right">
              <li class="divider-vertical">
{% if not user.username %}
              <li><a href="{% url appraise.views.login %}">Login</a></li>
{% else %}
              <li class="dropdown">
                <a class="dropdown-toggle" href="#" data-toggle="dropdown">{{ user.username }} <b class="caret"></b></a>

                <ul class="dropdown-menu">

{% if admin_url and user.is_superuser %}
                  <li><a href="{{admin_url}}">Admin</a></li>
{% endif %}
                  <li><a href="{% url appraise.views.password_change %}">Change password</a></li>
                  <li><a href="{% url appraise.views.logout %}">Logout "{{user.username}}"</a></li>
                </ul>
              </li>

{% endif %}
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>
<!--- 
<div class="cd-popup" role="alert">
  <div class="cd-popup-container">
    <p><span id="cd_popup_message">Text here!!!</span></p>
    <ul class="cd-buttons" style="list-style: none;" align="center">
      <li><a href="#0" onClick='$("#myform").submit();'>Close</a></li>
    </ul>
    <a href="#0" class="cd-popup-close img-replace" onClick='$("#myform").submit();'>Close</a>
  </div>  
</div>  -->

    <div class="container">
      {% block content %}{% endblock %}

      <hr/>

      <footer>
        <p>This is the GitHub version {% if commit_tag %}<code><a href="https://github.com/cfedermann/Appraise/commit/{{commit_tag}}">{{commit_tag|stringformat:".8s"}}</a></code>{% endif %} of the Appraise evaluation system. Some rights reserved. Developed and maintained by <a href="mailto:cfedermann [at] gmail [dot] com">Christian Federmann</a>.{% block footer %}{% endblock %}</p>
      </footer>

    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="{{bootstrap_url}}/assets/js/jquery.js"></script>
    <script src="{{bootstrap_url}}/assets/js/bootstrap-transition.js"></script>
    <script src="{{bootstrap_url}}/assets/js/bootstrap-alert.js"></script>
    <script src="{{bootstrap_url}}/assets/js/bootstrap-modal.js"></script>
    <script src="{{bootstrap_url}}/assets/js/bootstrap-dropdown.js"></script>
    <script src="{{bootstrap_url}}/assets/js/bootstrap-scrollspy.js"></script>
    <script src="{{bootstrap_url}}/assets/js/bootstrap-tab.js"></script>
    <script src="{{bootstrap_url}}/assets/js/bootstrap-tooltip.js"></script>
    <script src="{{bootstrap_url}}/assets/js/bootstrap-popover.js"></script>
    <script src="{{bootstrap_url}}/assets/js/bootstrap-button.js"></script>
    <script src="{{bootstrap_url}}/assets/js/bootstrap-collapse.js"></script>
    <script src="{{bootstrap_url}}/assets/js/bootstrap-carousel.js"></script>
    <script src="{{bootstrap_url}}/assets/js/bootstrap-typeahead.js"></script>

  </body>
</html>
{% endwith %}